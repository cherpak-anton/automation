steps:
  # ---------------------------------------------
  # (0) Copy source/ to GCS before calling functions
  # ---------------------------------------------
  - name: "gcr.io/cloud-builders/gcloud"
    entrypoint: bash
    args:
      - -c
      - |
        echo "üìÅ –§–∞–π–ª—ã –¥–ª—è –∫–æ–ø–∏—Ä–æ–≤–∞–Ω–∏—è –∏–∑ tests/wikly/:"
        ls -R tests/wikly/
        
        echo "‚¨ÜÔ∏è –ö–æ–ø–∏—Ä—É–µ–º –≤ GCS: gs://qa-test-roidev/tests-wikly/"
        gsutil -m cp -r tests/wikly/* gs://qa-test-roidev/tests-wikly/
        
        echo "‚úÖ –ö–æ–ø–∏—Ä–æ–≤–∞–Ω–∏–µ –∑–∞–≤–µ—Ä—à–µ–Ω–æ. –°–æ–¥–µ—Ä–∂–∏–º–æ–µ –±–∞–∫–µ—Ç–∞:"
        gsutil ls -R gs://qa-test-roidev/tests-wikly/source/

  # ---------------------------------------------
  # (1) –í—ã–∑–æ–≤ Cloud Run Job (–ß–µ—Ä–µ–∑ –≤–Ω–µ—à–Ω–∏–π —Å–∫—Ä–∏–ø—Ç)
  # ---------------------------------------------
  - name: "gcr.io/cloud-builders/gcloud"
    entrypoint: 'python3' 
    args:
      - "tests/wikly/deploy_function.py" 
      - "${BUILD_ID}"
    env:
      - 'CLOUD_PROJECT_ID=${PROJECT_ID}'

options:
  logging: CLOUD_LOGGING_ONLY
