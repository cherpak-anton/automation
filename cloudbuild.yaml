steps:
  # Install dependencies
  - name: "python:3.11"
    entrypoint: "bash"
    args:
      - "-c"
      - |
        pip install -r requirements.txt -t ./package

  # Deploy to multiple regions
  - name: "gcr.io/google.com/cloudsdktool/cloud-sdk:latest"
    entrypoint: "bash"
    args:
      - "-c"
      - |
        REGIONS=("us-central1")

        for REGION in "${REGIONS[@]}"; do
          echo "Deploying to region: $REGION"

          gcloud functions deploy my_function \
            --gen2 \
            --region=$REGION \
            --runtime=python311 \
            --source=. \
            --entry-point=main \
            --trigger-http \
            --allow-unauthenticated
        done

timeout: 1200s
